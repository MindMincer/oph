(function(e,t){typeof define=="function"&&define.amd?define(["d3"],function(n){return e.Rickshaw=t(n)}):typeof exports=="object"?module.exports=t(require("d3")):e.Rickshaw=t(d3)})(this,function(e){var t={namespace:function(e,n){var r=e.split("."),i=t;for(var s=1,o=r.length;s<o;s++){var u=r[s];i[u]=i[u]||{},i=i[u]}return i},keys:function(e){var t=[];for(var n in e)t.push(n);return t},extend:function(e,t){for(var n in t)e[n]=t[n];return e},clone:function(e){return JSON.parse(JSON.stringify(e))}};return function(e){function f(e){return t.call(e)===a}function l(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function c(e){if(h(e)!==u)throw new TypeError;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}function h(e){switch(e){case null:return n;case void 0:return r}var t=typeof e;switch(t){case"boolean":return i;case"number":return s;case"string":return o}return u}function p(e){return typeof e=="undefined"}function v(e){var t=e.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return t.length==1&&!t[0]?[]:t}function m(e,t){var n=e;return function(){var e=g([b(n,this)],arguments);return t.apply(this,e)}}function g(e,t){var n=e.length,r=t.length;while(r--)e[n+r]=t[r];return e}function y(e,t){return e=d.call(e,0),g(e,t)}function b(e,t){if(arguments.length<2&&p(arguments[0]))return this;var n=e,r=d.call(arguments,2);return function(){var e=y(r,arguments);return n.apply(t,e)}}var t=Object.prototype.toString,n="Null",r="Undefined",i="Boolean",s="Number",o="String",u="Object",a="[object Function]",d=Array.prototype.slice,w=function(){},E=function(){function t(){}function n(){function r(){this.initialize.apply(this,arguments)}var e=null,n=[].slice.apply(arguments);f(n[0])&&(e=n.shift()),l(r,E.Methods),r.superclass=e,r.subclasses=[];if(e){t.prototype=e.prototype,r.prototype=new t;try{e.subclasses.push(r)}catch(i){}}for(var s=0,o=n.length;s<o;s++)r.addMethods(n[s]);return r.prototype.initialize||(r.prototype.initialize=w),r.prototype.constructor=r,r}function r(t){var n=this.superclass&&this.superclass.prototype,r=c(t);e&&(t.toString!=Object.prototype.toString&&r.push("toString"),t.valueOf!=Object.prototype.valueOf&&r.push("valueOf"));for(var i=0,s=r.length;i<s;i++){var o=r[i],u=t[o];if(n&&f(u)&&v(u)[0]=="$super"){var a=u;u=m(function(e){return function(){return n[e].apply(this,arguments)}}(o),a),u.valueOf=b(a.valueOf,a),u.toString=b(a.toString,a)}this.prototype[o]=u}return this}var e=function(){for(var e in{toString:1})if(e==="toString")return!1;return!0}();return{create:n,Methods:{addMethods:r}}}();e.exports?e.exports.Class=E:e.Class=E}(t),t.namespace("Rickshaw.Compat.ClassList"),t.Compat.ClassList=function(){typeof document!="undefined"&&!("classList"in document.createElement("a"))&&function(e){"use strict";var t="classList",n="prototype",r=(e.HTMLElement||e.Element)[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},u=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(t==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},f=function(e){var t=s.call(e.className),n=t?t.split(/\s+/):[],r=0,i=n.length;for(;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.className=this.toString()}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",a(this,e)!==-1},l.add=function(e){e+="",a(this,e)===-1&&(this.push(e),this._updateClassName())},l.remove=function(e){e+="";var t=a(this,e);t!==-1&&(this.splice(t,1),this._updateClassName())},l.toggle=function(e){e+="",a(this,e)===-1?this.add(e):this.remove(e)},l.toString=function(){return this.join(" ")};if(i.defineProperty){var h={get:c,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,h)}catch(p){p.number===-2146823252&&(h.enumerable=!1,i.defineProperty(r,t,h))}}else i[n].__defineGetter__&&r.__defineGetter__(t,c)}(window)},(typeof RICKSHAW_NO_COMPAT!="undefined"&&!RICKSHAW_NO_COMPAT||typeof RICKSHAW_NO_COMPAT=="undefined")&&new t.Compat.ClassList,t.namespace("Rickshaw.Graph"),t.Graph=function(n){var r=this;this.initialize=function(t){if(!t.element)throw"Rickshaw.Graph needs a reference to an element";if(t.element.nodeType!==1)throw"Rickshaw.Graph element was defined but not an HTML element";this.element=t.element,this.series=t.series,this.window={},this.updateCallbacks=[],this.configureCallbacks=[],this.defaults={interpolation:"cardinal",offset:"zero",min:undefined,max:undefined,preserve:!1,xScale:undefined,yScale:undefined,stack:!0},this._loadRenderers(),this.configure(t),this.validateSeries(t.series),this.series.active=function(){return r.series.filter(function(e){return!e.disabled})},this.setSize({width:t.width,height:t.height}),this.element.classList.add("rickshaw_graph"),this.vis=e.select(this.element).append("svg:svg").attr("width",this.width).attr("height",this.height),this.discoverRange()},this._loadRenderers=function(){for(var e in t.Graph.Renderer){if(!e||!t.Graph.Renderer.hasOwnProperty(e))continue;var n=t.Graph.Renderer[e];if(!n||!n.prototype||!n.prototype.render)continue;r.registerRenderer(new n({graph:r}))}},this.validateSeries=function(e){if(!Array.isArray(e)&&!(e instanceof t.Series)){var n=Object.prototype.toString.apply(e);throw"series is not an array: "+n}var r;e.forEach(function(e){if(!(e instanceof Object))throw"series element is not an object: "+e;if(!e.data)throw"series has no data: "+JSON.stringify(e);if(!Array.isArray(e.data))throw"series data is not an array: "+JSON.stringify(e.data);if(e.data.length>0){var t=e.data[0].x,n=e.data[0].y;if(typeof t!="number"||typeof n!="number"&&n!==null)throw"x and y properties of points should be numbers instead of "+typeof t+" and "+typeof n}if(e.data.length>=3)if(e.data[2].x<e.data[1].x||e.data[1].x<e.data[0].x||e.data[e.data.length-1].x<e.data[0].x)throw"series data needs to be sorted on x values for series name: "+e.name},this)},this.dataDomain=function(){var t=this.series.map(function(e){return e.data}),n=e.min(t.map(function(e){return e[0].x})),r=e.max(t.map(function(e){return e[e.length-1].x}));return[n,r]},this.discoverRange=function(){var t=this.renderer.domain();this.x=(this.xScale||e.scale.linear()).copy().domain(t.x).range([0,this.width]),this.y=(this.yScale||e.scale.linear()).copy().domain(t.y).range([this.height,0]),this.x.magnitude=e.scale.linear().domain([t.x[0]-t.x[0],t.x[1]-t.x[0]]).range([0,this.width]),this.y.magnitude=e.scale.linear().domain([t.y[0]-t.y[0],t.y[1]-t.y[0]]).range([0,this.height])},this.render=function(){var e=this.stackData();this.discoverRange(),this.renderer.render(),this.updateCallbacks.forEach(function(e){e()})},this.update=this.render,this.stackData=function(){var n=this.series.active().map(function(e){return e.data}).map(function(e){return e.filter(function(e){return this._slice(e)},this)},this),i=this.preserve;i||this.series.forEach(function(e){e.scale&&(i=!0)}),n=i?t.clone(n):n,this.series.active().forEach(function(e,t){if(e.scale){var r=n[t];r&&r.forEach(function(t){t.y=e.scale(t.y)})}}),this.stackData.hooks.data.forEach(function(e){n=e.f.apply(r,[n])});var s;if(!this.renderer.unstack){this._validateStackable();var o=e.layout.stack();o.offset(r.offset),s=o(n)}s=s||n,this.renderer.unstack&&s.forEach(function(e){e.forEach(function(e){e.y0=e.y0===undefined?0:e.y0})}),this.stackData.hooks.after.forEach(function(e){s=e.f.apply(r,[n])});var u=0;return this.series.forEach(function(e){if(e.disabled)return;e.stack=s[u++]}),this.stackedData=s,s},this._validateStackable=function(){var e=this.series,t;e.forEach(function(e){t=t||e.data.length;if(t&&e.data.length!=t)throw"stacked series cannot have differing numbers of points: "+t+" vs "+e.data.length+"; see Rickshaw.Series.fill()"},this)},this.stackData.hooks={data:[],after:[]},this._slice=function(e){if(this.window.xMin||this.window.xMax){var t=!0;return this.window.xMin&&e.x<this.window.xMin&&(t=!1),this.window.xMax&&e.x>this.window.xMax&&(t=!1),t}return!0},this.onUpdate=function(e){this.updateCallbacks.push(e)},this.onConfigure=function(e){this.configureCallbacks.push(e)},this.registerRenderer=function(e){this._renderers=this._renderers||{},this._renderers[e.name]=e},this.configure=function(e){this.config=this.config||{},(e.width||e.height)&&this.setSize(e),t.keys(this.defaults).forEach(function(t){this.config[t]=t in e?e[t]:t in this?this[t]:this.defaults[t]},this),t.keys(this.config).forEach(function(e){this[e]=this.config[e]},this),"stack"in e&&(e.unstack=!e.stack);var n=e.renderer||this.renderer&&this.renderer.name||"stack";this.setRenderer(n,e),this.configureCallbacks.forEach(function(t){t(e)})},this.setRenderer=function(e,t){if(typeof e=="function")this.renderer=new e({graph:r}),this.registerRenderer(this.renderer);else{if(!this._renderers[e])throw"couldn't find renderer "+e;this.renderer=this._renderers[e]}typeof t=="object"&&this.renderer.configure(t)},this.setSize=function(e){e=e||{};if(typeof window!==undefined)var t=window.getComputedStyle(this.element,null),n=parseInt(t.getPropertyValue("width"),10),r=parseInt(t.getPropertyValue("height"),10);this.width=e.width||n||400,this.height=e.height||r||250,this.vis&&this.vis.attr("width",this.width).attr("height",this.height)},this.initialize(n)},t.namespace("Rickshaw.Fixtures.Color"),t.Fixtures.Color=function(){this.schemes={},this.schemes.spectrum14=["#ecb796","#dc8f70","#b2a470","#92875a","#716c49","#d2ed82","#bbe468","#a1d05d","#e7cbe6","#d8aad6","#a888c2","#9dc2d3","#649eb9","#387aa3"].reverse(),this.schemes.spectrum2000=["#57306f","#514c76","#646583","#738394","#6b9c7d","#84b665","#a7ca50","#bfe746","#e2f528","#fff726","#ecdd00","#d4b11d","#de8800","#de4800","#c91515","#9a0000","#7b0429","#580839","#31082b"],this.schemes.spectrum2001=["#2f243f","#3c2c55","#4a3768","#565270","#6b6b7c","#72957f","#86ad6e","#a1bc5e","#b8d954","#d3e04e","#ccad2a","#cc8412","#c1521d","#ad3821","#8a1010","#681717","#531e1e","#3d1818","#320a1b"],this.schemes.classic9=["#423d4f","#4a6860","#848f39","#a2b73c","#ddcb53","#c5a32f","#7d5836","#963b20","#7c2626","#491d37","#2f254a"].reverse(),this.schemes.httpStatus={503:"#ea5029",502:"#d23f14",500:"#bf3613",410:"#efacea",409:"#e291dc",403:"#f457e8",408:"#e121d2",401:"#b92dae",405:"#f47ceb",404:"#a82a9f",400:"#b263c6",301:"#6fa024",302:"#87c32b",307:"#a0d84c",304:"#28b55c",200:"#1a4f74",206:"#27839f",201:"#52adc9",202:"#7c979f",203:"#a5b8bd",204:"#c1cdd1"},this.schemes.colorwheel=["#b5b6a9","#858772","#785f43","#96557e","#4682b4","#65b9ac","#73c03a","#cb513a"].reverse(),this.schemes.cool=["#5e9d2f","#73c03a","#4682b4","#7bc3b8","#a9884e","#c1b266","#a47493","#c09fb5"],this.schemes.munin=["#00cc00","#0066b3","#ff8000","#ffcc00","#330099","#990099","#ccff00","#ff0000","#808080","#008f00","#00487d","#b35a00","#b38f00","#6b006b","#8fb300","#b30000","#bebebe","#80ff80","#80c9ff","#ffc080","#ffe680","#aa80ff","#ee00cc","#ff8080","#666600","#ffbfff","#00ffcc","#cc6699","#999900"]},t.namespace("Rickshaw.Fixtures.RandomData"),t.Fixtures.RandomData=function(e){var t;e=e||1;var n=200,r=Math.floor((new Date).getTime()/1e3);this.addData=function(t){var i=Math.random()*100+15+n,s=t[0].length,o=1;t.forEach(function(t){var n=Math.random()*20,u=i/25+o++ +(Math.cos(s*o*11/960)+2)*15+(Math.cos(s/7)+2)*7+(Math.cos(s/17)+2)*1;t.push({x:s*e+r,y:u+n})}),n=i*.85},this.removeData=function(t){t.forEach(function(e){e.shift()}),r+=e}},t.namespace("Rickshaw.Fixtures.Time"),t.Fixtures.Time=function(){var t=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.units=[{name:"decade",seconds:315576e3,formatter:function(e){return parseInt(e.getUTCFullYear()/10,10)*10}},{name:"year",seconds:31557600,formatter:function(e){return e.getUTCFullYear()}},{name:"month",seconds:2635200,formatter:function(e){return t.months[e.getUTCMonth()]}},{name:"week",seconds:604800,formatter:function(e){return t.formatDate(e)}},{name:"day",seconds:86400,formatter:function(e){return e.getUTCDate()}},{name:"6 hour",seconds:21600,formatter:function(e){return t.formatTime(e)}},{name:"hour",seconds:3600,formatter:function(e){return t.formatTime(e)}},{name:"15 minute",seconds:900,formatter:function(e){return t.formatTime(e)}},{name:"minute",seconds:60,formatter:function(e){return e.getUTCMinutes()}},{name:"15 second",seconds:15,formatter:function(e){return e.getUTCSeconds()+"s"}},{name:"second",seconds:1,formatter:function(e){return e.getUTCSeconds()+"s"}},{name:"decisecond",seconds:.1,formatter:function(e){return e.getUTCMilliseconds()+"ms"}},{name:"centisecond",seconds:.01,formatter:function(e){return e.getUTCMilliseconds()+"ms"}}],this.unit=function(e){return this.units.filter(function(t){return e==t.name}).shift()},this.formatDate=function(t){return e.time.format("%b %e")(t)},this.formatTime=function(e){return e.toUTCString().match(/(\d+:\d+):/)[1]},this.ceil=function(e,t){var n,r,i;if(t.name=="month"){n=new Date(e*1e3),r=Date.UTC(n.getUTCFullYear(),n.getUTCMonth())/1e3;if(r==e)return e;i=n.getUTCFullYear();var s=n.getUTCMonth();return s==11?(s=0,i+=1):s+=1,Date.UTC(i,s)/1e3}return t.name=="year"?(n=new Date(e*1e3),r=Date.UTC(n.getUTCFullYear(),0)/1e3,r==e?e:(i=n.getUTCFullYear()+1,Date.UTC(i,0)/1e3)):Math.ceil(e/t.seconds)*t.seconds}},t.namespace("Rickshaw.Fixtures.Time.Local"),t.Fixtures.Time.Local=function(){var t=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.units=[{name:"decade",seconds:315576e3,formatter:function(e){return parseInt(e.getFullYear()/10,10)*10}},{name:"year",seconds:31557600,formatter:function(e){return e.getFullYear()}},{name:"month",seconds:2635200,formatter:function(e){return t.months[e.getMonth()]}},{name:"week",seconds:604800,formatter:function(e){return t.formatDate(e)}},{name:"day",seconds:86400,formatter:function(e){return e.getDate()}},{name:"6 hour",seconds:21600,formatter:function(e){return t.formatTime(e)}},{name:"hour",seconds:3600,formatter:function(e){return t.formatTime(e)}},{name:"15 minute",seconds:900,formatter:function(e){return t.formatTime(e)}},{name:"minute",seconds:60,formatter:function(e){return e.getMinutes()}},{name:"15 second",seconds:15,formatter:function(e){return e.getSeconds()+"s"}},{name:"second",seconds:1,formatter:function(e){return e.getSeconds()+"s"}},{name:"decisecond",seconds:.1,formatter:function(e){return e.getMilliseconds()+"ms"}},{name:"centisecond",seconds:.01,formatter:function(e){return e.getMilliseconds()+"ms"}}],this.unit=function(e){return this.units.filter(function(t){return e==t.name}).shift()},this.formatDate=function(t){return e.time.format("%b %e")(t)},this.formatTime=function(e){return e.toString().match(/(\d+:\d+):/)[1]},this.ceil=function(e,t){var n,r,i;if(t.name=="day"){var s=new Date((e+t.seconds-1)*1e3),o=new Date(0);return o.setMilliseconds(0),o.setSeconds(0),o.setMinutes(0),o.setHours(0),o.setDate(s.getDate()),o.setMonth(s.getMonth()),o.setFullYear(s.getFullYear()),o.getTime()/1e3}if(t.name=="month"){n=new Date(e*1e3),r=(new Date(n.getFullYear(),n.getMonth())).getTime()/1e3;if(r==e)return e;i=n.getFullYear();var u=n.getMonth();return u==11?(u=0,i+=1):u+=1,(new Date(i,u)).getTime()/1e3}return t.name=="year"?(n=new Date(e*1e3),r=(new Date(n.getUTCFullYear(),0)).getTime()/1e3,r==e?e:(i=n.getFullYear()+1,(new Date(i,0)).getTime()/1e3)):Math.ceil(e/t.seconds)*t.seconds}},t.namespace("Rickshaw.Fixtures.Number"),t.Fixtures.Number.formatKMBT=function(e){var t=Math.abs(e);return t>=1e12?e/1e12+"T":t>=1e9?e/1e9+"B":t>=1e6?e/1e6+"M":t>=1e3?e/1e3+"K":t<1&&e>0?e.toFixed(2):t===0?"":e},t.Fixtures.Number.formatBase1024KMGTP=function(e){var t=Math.abs(e);return t>=0x4000000000000?e/0x4000000000000+"P":t>=1099511627776?e/1099511627776+"T":t>=1073741824?e/1073741824+"G":t>=1048576?e/1048576+"M":t>=1024?e/1024+"K":t<1&&e>0?e.toFixed(2):t===0?"":e},t.namespace("Rickshaw.Color.Palette"),t.Color.Palette=function(n){var r=new t.Fixtures.Color;n=n||{},this.schemes={},this.scheme=r.schemes[n.scheme]||n.scheme||r.schemes.colorwheel,this.runningIndex=0,this.generatorIndex=0;if(n.interpolatedStopCount){var i=this.scheme.length-1,s,o,u=[];for(s=0;s<i;s++){u.push(this.scheme[s]);var a=e.interpolateHsl(this.scheme[s],this.scheme[s+1]);for(o=1;o<n.interpolatedStopCount;o++)u.push(a(1/n.interpolatedStopCount*o))}u.push(this.scheme[this.scheme.length-1]),this.scheme=u}this.rotateCount=this.scheme.length,this.color=function(e){return this.scheme[e]||this.scheme[this.runningIndex++]||this.interpolateColor()||"#808080"},this.interpolateColor=function(){if(!Array.isArray(this.scheme))return;var t;return this.generatorIndex==this.rotateCount*2-1?(t=e.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[0])(.5),this.generatorIndex=0,this.rotateCount*=2):(t=e.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[this.generatorIndex+1])(.5),this.generatorIndex++),this.scheme.push(t),t}},t.namespace("Rickshaw.Graph.Ajax"),t.Graph.Ajax=t.Class.create({initialize:function(e){this.dataURL=e.dataURL,this.onData=e.onData||function(e){return e},this.onComplete=e.onComplete||function(){},this.onError=e.onError||function(){},this.args=e,this.request()},request:function(){jQuery.ajax({url:this.dataURL,dataType:"json",success:this.success.bind(this),error:this.error.bind(this)})},error:function(){console.log("error loading dataURL: "+this.dataURL),this.onError(this)},success:function(e,n){e=this.onData(e),this.args.series=this._splice({data:e,series:this.args.series}),this.graph=this.graph||new t.Graph(this.args),this.graph.render(),this.onComplete(this)},_splice:function(e){var t=e.data,n=e.series;return e.series?(n.forEach(function(e){var n=e.key||e.name;if(!n)throw"series needs a key or a name";t.forEach(function(t){var r=t.key||t.name;if(!r)throw"data needs a key or a name";if(n==r){var i=["color","name","data"];i.forEach(function(n){t[n]&&(e[n]=t[n])})}})}),n):t}}),t.namespace("Rickshaw.Graph.Annotate"),t.Graph.Annotate=function(e){var n=this.graph=e.graph;this.elements={timeline:e.element};var r=this;this.data={},this.elements.timeline.classList.add("rickshaw_annotation_timeline"),this.add=function(e,t,n){r.data[e]=r.data[e]||{boxes:[]},r.data[e].boxes.push({content:t,end:n})},this.update=function(){t.keys(r.data).forEach(function(e){var t=r.data[e],n=r.graph.x(e);if(n<0||n>r.graph.x.range()[1]){t.element&&(t.line.classList.add("offscreen"),t.element.style.display="none"),t.boxes.forEach(function(e){e.rangeElement&&e.rangeElement.classList.add("offscreen")});return}if(!t.element){var i=t.element=document.createElement("div");i.classList.add("annotation"),this.elements.timeline.appendChild(i),i.addEventListener("click",function(e){i.classList.toggle("active"),t.line.classList.toggle("active"),t.boxes.forEach(function(e){e.rangeElement&&e.rangeElement.classList.toggle("active")})},!1)}t.element.style.left=n+"px",t.element.style.display="block",t.boxes.forEach(function(e){var i=e.element;i||(i=e.element=document.createElement("div"),i.classList.add("content"),i.innerHTML=e.content,t.element.appendChild(i),t.line=document.createElement("div"),t.line.classList.add("annotation_line"),r.graph.element.appendChild(t.line),e.end&&(e.rangeElement=document.createElement("div"),e.rangeElement.classList.add("annotation_range"),r.graph.element.appendChild(e.rangeElement)));if(e.end){var s=n,o=Math.min(r.graph.x(e.end),r.graph.x.range()[1]);s>o&&(o=n,s=Math.max(r.graph.x(e.end),r.graph.x.range()[0]));var u=o-s;e.rangeElement.style.left=s+"px",e.rangeElement.style.width=u+"px",e.rangeElement.classList.remove("offscreen")}t.line.classList.remove("offscreen"),t.line.style.left=n+"px"})},this)},this.graph.onUpdate(function(){r.update()})},t.namespace("Rickshaw.Graph.Axis.Time"),t.Graph.Axis.Time=function(e){var n=this;this.graph=e.graph,this.elements=[],this.ticksTreatment=e.ticksTreatment||"plain",this.fixedTimeUnit=e.timeUnit;var r=e.timeFixture||new t.Fixtures.Time;this.appropriateTimeUnit=function(){var e,t=r.units,n=this.graph.x.domain(),i=n[1]-n[0];return t.forEach(function(t){Math.floor(i/t.seconds)>=2&&(e=e||t)}),e||r.units[r.units.length-1]},this.tickOffsets=function(){var e=this.graph.x.domain(),t=this.fixedTimeUnit||this.appropriateTimeUnit(),n=Math.ceil((e[1]-e[0])/t.seconds),i=e[0],s=[];for(var o=0;o<n;o++){var u=r.ceil(i,t);i=u+t.seconds/2,s.push({value:u,unit:t})}return s},this.render=function(){this.elements.forEach(function(e){e.parentNode.removeChild(e)}),this.elements=[];var e=this.tickOffsets();e.forEach(function(e){if(n.graph.x(e.value)>n.graph.x.range()[1])return;var t=document.createElement("div");t.style.left=n.graph.x(e.value)+"px",t.classList.add("x_tick"),t.classList.add(n.ticksTreatment);var r=document.createElement("div");r.classList.add("title"),r.innerHTML=e.unit.formatter(new Date(e.value*1e3)),t.appendChild(r),n.graph.element.appendChild(t),n.elements.push(t)})},this.graph.onUpdate(function(){n.render()})},t.namespace("Rickshaw.Graph.Axis.X"),t.Graph.Axis.X=function(t){var n=this,r=.1;this.initialize=function(t){this.graph=t.graph,this.orientation=t.orientation||"top",this.pixelsPerTick=t.pixelsPerTick||75,t.ticks&&(this.staticTicks=t.ticks),t.tickValues&&(this.tickValues=t.tickValues),this.tickSize=t.tickSize||4,this.ticksTreatment=t.ticksTreatment||"plain",t.element?(this.element=t.element,this._discoverSize(t.element,t),this.vis=e.select(t.element).append("svg:svg").attr("height",this.height).attr("width",this.width).attr("class","rickshaw_graph x_axis_d3"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:t.width,height:t.height})):this.vis=this.graph.vis,this.graph.onUpdate(function(){n.render()})},this.setSize=function(e){e=e||{};if(!this.element)return;this._discoverSize(this.element.parentNode,e),this.vis.attr("height",this.height).attr("width",this.width*(1+r));var t=Math.floor(this.width*r/2);this.element.style.left=-1*t+"px"},this.render=function(){this._renderWidth!==undefined&&this.graph.width!==this._renderWidth&&this.setSize({auto:!0});var n=e.svg.axis().scale(this.graph.x).orient(this.orientation);n.tickFormat(t.tickFormat||function(e){return e}),this.tickValues&&n.tickValues(this.tickValues),this.ticks=this.staticTicks||Math.floor(this.graph.width/this.pixelsPerTick);var i=Math.floor(this.width*r/2)||0,s;if(this.orientation=="top"){var o=this.height||this.graph.height;s="translate("+i+","+o+")"}else s="translate("+i+", 0)";this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["x_ticks_d3",this.ticksTreatment].join(" ")).attr("transform",s).call(n.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));var u=(this.orientation=="bottom"?1:-1)*this.graph.height;this.graph.vis.append("svg:g").attr("class","x_grid_d3").call(n.ticks(this.ticks).tickSubdivide(0).tickSize(u)).selectAll("text").each(function(){this.parentNode.setAttribute("data-x-value",this.textContent)}),this._renderHeight=this.graph.height},this._discoverSize=function(e,t){if(typeof window!="undefined"){var n=window.getComputedStyle(e,null),i=parseInt(n.getPropertyValue("height"),10);if(!t.auto)var s=parseInt(n.getPropertyValue("width"),10)}this.width=(t.width||s||this.graph.width)*(1+r),this.height=t.height||i||40},this.initialize(t)},t.namespace("Rickshaw.Graph.Axis.Y"),t.Graph.Axis.Y=t.Class.create({initialize:function(t){this.graph=t.graph,this.orientation=t.orientation||"right",this.pixelsPerTick=t.pixelsPerTick||75,t.ticks&&(this.staticTicks=t.ticks),t.tickValues&&(this.tickValues=t.tickValues),this.tickSize=t.tickSize||4,this.ticksTreatment=t.ticksTreatment||"plain",this.tickFormat=t.tickFormat||function(e){return e},this.berthRate=.1,t.element?(this.element=t.element,this.vis=e.select(t.element).append("svg:svg").attr("class","rickshaw_graph y_axis"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:t.width,height:t.height})):this.vis=this.graph.vis;var n=this;this.graph.onUpdate(function(){n.render()})},setSize:function(e){e=e||{};if(!this.element)return;if(typeof window!="undefined"){var t=window.getComputedStyle(this.element.parentNode,null),n=parseInt(t.getPropertyValue("width"),10);if(!e.auto)var r=parseInt(t.getPropertyValue("height"),10)}this.width=e.width||n||this.graph.width*this.berthRate,this.height=e.height||r||this.graph.height,this.vis.attr("width",this.width).attr("height",this.height*(1+this.berthRate));var i=this.height*this.berthRate;this.orientation=="left"&&(this.element.style.top=-1*i+"px")},render:function(){this._renderHeight!==undefined&&this.graph.height!==this._renderHeight&&this.setSize({auto:!0}),this.ticks=this.staticTicks||Math.floor(this.graph.height/this.pixelsPerTick);var e=this._drawAxis(this.graph.y);this._drawGrid(e),this._renderHeight=this.graph.height},_drawAxis:function(t){var n=e.svg.axis().scale(t).orient(this.orientation);n.tickFormat(this.tickFormat),this.tickValues&&n.tickValues(this.tickValues);if(this.orientation=="left")var r=this.height*this.berthRate,i="translate("+this.width+", "+r+")";return this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["y_ticks",this.ticksTreatment].join(" ")).attr("transform",i).call(n.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize)),n},_drawGrid:function(e){var t=(this.orientation=="right"?1:-1)*this.graph.width;this.graph.vis.append("svg:g").attr("class","y_grid").call(e.ticks(this.ticks).tickSubdivide(0).tickSize(t)).selectAll("text").each(function(){this.parentNode.setAttribute("data-y-value",this.textContent)})}}),t.namespace("Rickshaw.Graph.Axis.Y.Scaled"),t.Graph.Axis.Y.Scaled=t.Class.create(t.Graph.Axis.Y,{initialize:function($super,e){if(typeof e.scale=="undefined")throw new Error("Scaled requires scale");this.scale=e.scale,typeof e.grid=="undefined"?this.grid=!0:this.grid=e.grid,$super(e)},_drawAxis:function($super,t){var n=this.scale.domain(),r=this.graph.renderer.domain().y,i=[Math.min.apply(Math,n),Math.max.apply(Math,n)],s=e.scale.linear().domain([0,1]).range(i),o=[s(r[0]),s(r[1])],u=e.scale.linear().domain(i).range(o),a=this.scale.copy().domain(n.map(u)).range(t.range());return $super(a)},_drawGrid:function($super,e){this.grid&&$super(e)}}),t.namespace("Rickshaw.Graph.Behavior.Series.Highlight"),t.Graph.Behavior.Series.Highlight=function(t){this.graph=t.graph,this.legend=t.legend;var n=this,r={},i=null,s=t.disabledColor||function(t){return e.interpolateRgb(t,e.rgb("#d8d8d8"))(.8).toString()};this.addHighlightEvents=function(e){e.element.addEventListener("mouseover",function(t){if(i)return;i=e,n.legend.lines.forEach(function(t){if(e===t){if(n.graph.renderer.unstack&&(t.series.renderer?t.series.renderer.unstack:!0)){var i=n.graph.series.indexOf(t.series);t.originalIndex=i;var o=n.graph.series.splice(i,1)[0];n.graph.series.push(o)}return}r[t.series.name]=r[t.series.name]||t.series.color,t.series.color=s(t.series.color)}),n.graph.update()},!1),e.element.addEventListener("mouseout",function(t){if(!i)return;i=null,n.legend.lines.forEach(function(t){if(e===t&&t.hasOwnProperty("originalIndex")){var i=n.graph.series.pop();n.graph.series.splice(t.originalIndex,0,i),delete t.originalIndex}r[t.series.name]&&(t.series.color=r[t.series.name])}),n.graph.update()},!1)},this.legend&&this.legend.lines.forEach(function(e){n.addHighlightEvents(e)})},t.namespace("Rickshaw.Graph.Behavior.Series.Order"),t.Graph.Behavior.Series.Order=function(e){this.graph=e.graph,this.legend=e.legend;var t=this;if(typeof window.jQuery=="undefined")throw"couldn't find jQuery at window.jQuery";if(typeof window.jQuery.ui=="undefined")throw"couldn't find jQuery UI at window.jQuery.ui";jQuery(function(){jQuery(t.legend.list).sortable({containment:"parent",tolerance:"pointer",update:function(e,n){var r=[];jQuery(t.legend.list).find("li").each(function(e,t){if(!t.series)return;r.push(t.series)});for(var i=t.graph.series.length-1;i>=0;i--)t.graph.series[i]=r.shift();t.graph.update()}}),jQuery(t.legend.list).disableSelection()}),this.graph.onUpdate(function(){var e=window.getComputedStyle(t.legend.element).height;t.legend.element.style.height=e})},t.namespace("Rickshaw.Graph.Behavior.Series.Toggle"),t.Graph.Behavior.Series.Toggle=function(e){this.graph=e.graph,this.legend=e.legend;var t=this;this.addAnchor=function(e){var n=document.createElement("a");n.innerHTML="&#10004;",n.classList.add("action"),e.element.insertBefore(n,e.element.firstChild),n.onclick=function(t){if(e.series.disabled)e.series.enable(),e.element.classList.remove("disabled");else{if(this.graph.series.filter(function(e){return!e.disabled}).length<=1)return;e.series.disable(),e.element.classList.add("disabled")}}.bind(this);var r=e.element.getElementsByTagName("span")[0];r.onclick=function(n){var r=e.series.disabled;if(!r)for(var i=0;i<t.legend.lines.length;i++){var s=t.legend.lines[i];if(e.series!==s.series&&!s.series.disabled){r=!0;break}}r?(e.series.enable(),e.element.classList.remove("disabled"),t.legend.lines.forEach(function(t){e.series!==t.series&&(t.series.disable(),t.element.classList.add("disabled"))})):t.legend.lines.forEach(function(e){e.series.enable(),e.element.classList.remove("disabled")})}};if(this.legend){var n=jQuery;typeof n!="undefined"&&n(this.legend.list).sortable&&n(this.legend.list).sortable({start:function(e,t){t.item.bind("no.onclick",function(e){e.preventDefault()})},stop:function(e,t){setTimeout(function(){t.item.unbind("no.onclick")},250)}}),this.legend.lines.forEach(function(e){t.addAnchor(e)})}this._addBehavior=function(){this.graph.series.forEach(function(e){e.disable=function(){if(t.graph.series.length<=1)throw"only one series left";e.disabled=!0,t.graph.update()},e.enable=function(){e.disabled=!1,t.graph.update()}})},this._addBehavior(),this.updateBehaviour=function(){this._addBehavior()}},t.namespace("Rickshaw.Graph.HoverDetail"),t.Graph.HoverDetail=t.Class.create({initialize:function(e){var t=this.graph=e.graph;this.xFormatter=e.xFormatter||function(e){return(new Date(e*1e3)).toUTCString()},this.yFormatter=e.yFormatter||function(e){return e===null?e:e.toFixed(2)};var n=this.element=document.createElement("div");n.className="detail",this.visible=!0,t.element.appendChild(n),this.lastEvent=null,this._addListeners(),this.onShow=e.onShow,this.onHide=e.onHide,this.onRender=e.onRender,this.formatter=e.formatter||this.formatter},formatter:function(e,t,n,r,i,s){return e.name+":&nbsp;"+i},update:function(t){t=t||this.lastEvent;if(!t)return;this.lastEvent=t;if(!t.target.nodeName.match(/^(path|svg|rect|circle)$/))return;var n=this.graph,r=t.offsetX||t.layerX,i=t.offsetY||t.layerY,s=0,o=[],u;this.graph.series.active().forEach(function(t){var a=this.graph.stackedData[s++];if(!a.length)return;var f=n.x.invert(r),l=e.scale.linear().domain([a[0].x,a.slice(-1)[0].x]).range([0,a.length-1]),c=Math.round(l(f));c==a.length-1&&c--;var h=Math.min(c||0,a.length-1);for(var p=c;p<a.length-1;){if(!a[p]||!a[p+1])break;if(a[p].x<=f&&a[p+1].x>f){h=Math.abs(f-a[p].x)<Math.abs(f-a[p+1].x)?p:p+1;break}a[p+1].x<=f?p++:p--}h<0&&(h=0);var d=a[h],v=Math.sqrt(Math.pow(Math.abs(n.x(d.x)-r),2)+Math.pow(Math.abs(n.y(d.y+d.y0)-i),2)),m=t.xFormatter||this.xFormatter,g=t.yFormatter||this.yFormatter,y={formattedXValue:m(d.x),formattedYValue:g(t.scale?t.scale.invert(d.y):d.y),series:t,value:d,distance:v,order:s,name:t.name};if(!u||v<u.distance)u=y;o.push(y)},this);if(!u)return;u.active=!0;var a=u.value.x,f=u.formattedXValue;this.element.innerHTML="",this.element.style.left=n.x(a)+"px",this.visible&&this.render({points:o,detail:o,mouseX:r,mouseY:i,formattedXValue:f,domainX:a})},hide:function(){this.visible=!1,this.element.classList.add("inactive"),typeof this.onHide=="function"&&this.onHide()},show:function(){this.visible=!0,this.element.classList.remove("inactive"),typeof this.onShow=="function"&&this.onShow()},render:function(e){var t=this.graph,n=e.points,r=n.filter(function(e){return e.active}).shift();if(r.value.y===null)return;var i=r.formattedXValue,s=r.formattedYValue;this.element.innerHTML="",this.element.style.left=t.x(r.value.x)+"px";var o=document.createElement("div");o.className="x_label",o.innerHTML=i,this.element.appendChild(o);var u=document.createElement("div");u.className="item";var a=r.series,f=a.scale?a.scale.invert(r.value.y):r.value.y;u.innerHTML=this.formatter(a,r.value.x,f,i,s,r),u.style.top=this.graph.y(r.value.y0+r.value.y)+"px",this.element.appendChild(u);var l=document.createElement("div");l.className="dot",l.style.top=u.style.top,l.style.borderColor=a.color,this.element.appendChild(l),r.active&&(u.classList.add("active"),l
.classList.add("active"));var c=[o,u];c.forEach(function(e){e.classList.add("left")}),this.show();var h=this._calcLayoutError(c);if(h>0){c.forEach(function(e){e.classList.remove("left"),e.classList.add("right")});var p=this._calcLayoutError(c);p>h&&c.forEach(function(e){e.classList.remove("right"),e.classList.add("left")})}typeof this.onRender=="function"&&this.onRender(e)},_calcLayoutError:function(e){var t=this.element.parentNode.getBoundingClientRect(),n=0,r=e.forEach(function(e){var r=e.getBoundingClientRect();if(!r.width)return;r.right>t.right&&(n+=r.right-t.right),r.left<t.left&&(n+=t.left-r.left)});return n},_addListeners:function(){this.graph.element.addEventListener("mousemove",function(e){this.visible=!0,this.update(e)}.bind(this),!1),this.graph.onUpdate(function(){this.update()}.bind(this)),this.graph.element.addEventListener("mouseout",function(e){e.relatedTarget&&!(e.relatedTarget.compareDocumentPosition(this.graph.element)&Node.DOCUMENT_POSITION_CONTAINS)&&this.hide()}.bind(this),!1)}}),t.namespace("Rickshaw.Graph.JSONP"),t.Graph.JSONP=t.Class.create(t.Graph.Ajax,{request:function(){jQuery.ajax({url:this.dataURL,dataType:"jsonp",success:this.success.bind(this),error:this.error.bind(this)})}}),t.namespace("Rickshaw.Graph.Legend"),t.Graph.Legend=t.Class.create({className:"rickshaw_legend",initialize:function(e){this.element=e.element,this.graph=e.graph,this.naturalOrder=e.naturalOrder,this.element.classList.add(this.className),this.list=document.createElement("ul"),this.element.appendChild(this.list),this.render(),this.graph.onUpdate(function(){})},render:function(){var e=this;while(this.list.firstChild)this.list.removeChild(this.list.firstChild);this.lines=[];var t=this.graph.series.map(function(e){return e});this.naturalOrder||(t=t.reverse()),t.forEach(function(t){e.addLine(t)})},addLine:function(t){var n=document.createElement("li");n.className="line",t.disabled&&(n.className+=" disabled"),t.className&&e.select(n).classed(t.className,!0);var r=document.createElement("div");r.className="swatch",r.style.backgroundColor=t.color,n.appendChild(r);var i=document.createElement("span");i.className="label",i.innerHTML=t.name,n.appendChild(i),this.list.appendChild(n),n.series=t,t.noLegend&&(n.style.display="none");var s={element:n,series:t};return this.shelving&&(this.shelving.addAnchor(s),this.shelving.updateBehaviour()),this.highlighter&&this.highlighter.addHighlightEvents(s),this.lines.push(s),n}}),t.namespace("Rickshaw.Graph.RangeSlider"),t.Graph.RangeSlider=t.Class.create({initialize:function(e){var t=this.element=e.element,n=this.graph=e.graph;this.slideCallbacks=[],this.build(),n.onUpdate(function(){this.update()}.bind(this))},build:function(){var e=this.element,t=this.graph,n=jQuery,r=t.dataDomain(),i=this;n(function(){n(e).slider({range:!0,min:r[0],max:r[1],values:[r[0],r[1]],slide:function(e,n){if(n.values[1]<=n.values[0])return;t.window.xMin=n.values[0],t.window.xMax=n.values[1],t.update();var r=t.dataDomain();r[0]==n.values[0]&&(t.window.xMin=undefined),r[1]==n.values[1]&&(t.window.xMax=undefined),i.slideCallbacks.forEach(function(e){e(t,t.window.xMin,t.window.xMax)})}})}),n(e)[0].style.width=t.width+"px"},update:function(){var e=this.element,t=this.graph,n=jQuery,r=n(e).slider("option","values"),i=t.dataDomain();n(e).slider("option","min",i[0]),n(e).slider("option","max",i[1]),t.window.xMin==null&&(r[0]=i[0]),t.window.xMax==null&&(r[1]=i[1]),n(e).slider("option","values",r)},onSlide:function(e){this.slideCallbacks.push(e)}}),t.namespace("Rickshaw.Graph.RangeSlider.Preview"),t.Graph.RangeSlider.Preview=t.Class.create({initialize:function(t){if(!t.element)throw"Rickshaw.Graph.RangeSlider.Preview needs a reference to an element";if(!t.graph&&!t.graphs)throw"Rickshaw.Graph.RangeSlider.Preview needs a reference to an graph or an array of graphs";this.element=t.element,this.element.style.position="relative",this.graphs=t.graph?[t.graph]:t.graphs,this.defaults={height:75,width:400,gripperColor:undefined,frameTopThickness:3,frameHandleThickness:10,frameColor:"#d4d4d4",frameOpacity:1,minimumFrameWidth:0,heightRatio:.2},this.heightRatio=t.heightRatio||this.defaults.heightRatio,this.defaults.gripperColor=e.rgb(this.defaults.frameColor).darker().toString(),this.configureCallbacks=[],this.slideCallbacks=[],this.previews=[],t.width||(this.widthFromGraph=!0),t.height||(this.heightFromGraph=!0),(this.widthFromGraph||this.heightFromGraph)&&this.graphs[0].onConfigure(function(){this.configure(t),this.render()}.bind(this)),t.width=t.width||this.graphs[0].width||this.defaults.width,t.height=t.height||this.graphs[0].height*this.heightRatio||this.defaults.height,this.configure(t),this.render()},onSlide:function(e){this.slideCallbacks.push(e)},onConfigure:function(e){this.configureCallbacks.push(e)},configure:function(e){this.config=this.config||{},this.configureCallbacks.forEach(function(t){t(e)}),t.keys(this.defaults).forEach(function(t){this.config[t]=t in e?e[t]:t in this.config?this.config[t]:this.defaults[t]},this);if("width"in e||"height"in e)this.widthFromGraph&&(this.config.width=this.graphs[0].width),this.heightFromGraph&&(this.config.height=this.graphs[0].height*this.heightRatio,this.previewHeight=this.config.height),this.previews.forEach(function(e){var t=this.previewHeight/this.graphs.length-this.config.frameTopThickness*2,n=this.config.width-this.config.frameHandleThickness*2;e.setSize({width:n,height:t});if(this.svg){var r=t+this.config.frameHandleThickness*2,i=n+this.config.frameHandleThickness*2;this.svg.style("width",i+"px"),this.svg.style("height",r+"px")}},this)},render:function(){var n=this;this.svg=e.select(this.element).selectAll("svg.rickshaw_range_slider_preview").data([null]),this.previewHeight=this.config.height-this.config.frameTopThickness*2,this.previewWidth=this.config.width-this.config.frameHandleThickness*2,this.currentFrame=[0,this.previewWidth];var r=function(e,r){var i=t.extend({},e.config),s=n.previewHeight/n.graphs.length,o=e.renderer.name;t.extend(i,{element:this.appendChild(document.createElement("div")),height:s,width:n.previewWidth,series:e.series,renderer:o});var u=new t.Graph(i);n.previews.push(u),e.onUpdate(function(){u.render(),n.render()}),e.onConfigure(function(e){delete e.height,e.width=e.width-n.config.frameHandleThickness*2,u.configure(e),u.render()}),u.render()},i=e.select(this.element).selectAll("div.rickshaw_range_slider_preview_container").data(this.graphs),s="translate("+this.config.frameHandleThickness+"px, "+this.config.frameTopThickness+"px)";i.enter().append("div").classed("rickshaw_range_slider_preview_container",!0).style("-webkit-transform",s).style("-moz-transform",s).style("-ms-transform",s).style("transform",s).each(r),i.exit().remove();var o=this.graphs[0],u=e.scale.linear().domain([0,this.previewWidth]).range(o.dataDomain()),a=[o.window.xMin,o.window.xMax];this.currentFrame[0]=a[0]===undefined?0:Math.round(u.invert(a[0])),this.currentFrame[0]<0&&(this.currentFrame[0]=0),this.currentFrame[1]=a[1]===undefined?this.previewWidth:u.invert(a[1]),this.currentFrame[1]-this.currentFrame[0]<n.config.minimumFrameWidth&&(this.currentFrame[1]=(this.currentFrame[0]||0)+n.config.minimumFrameWidth),this.svg.enter().append("svg").classed("rickshaw_range_slider_preview",!0).style("height",this.config.height+"px").style("width",this.config.width+"px").style("position","absolute").style("top",0),this._renderDimming(),this._renderFrame(),this._renderGrippers(),this._renderHandles(),this._renderMiddle(),this._registerMouseEvents()},_renderDimming:function(){var e=this.svg.selectAll("path.dimming").data([null]);e.enter().append("path").attr("fill","white").attr("fill-opacity","0.7").attr("fill-rule","evenodd").classed("dimming",!0);var t="";t+=" M "+this.config.frameHandleThickness+" "+this.config.frameTopThickness,t+=" h "+this.previewWidth,t+=" v "+this.previewHeight,t+=" h "+ -this.previewWidth,t+=" z ",t+=" M "+Math.max(this.currentFrame[0],this.config.frameHandleThickness)+" "+this.config.frameTopThickness,t+=" H "+Math.min(this.currentFrame[1]+this.config.frameHandleThickness*2,this.previewWidth+this.config.frameHandleThickness),t+=" v "+this.previewHeight,t+=" H "+Math.max(this.currentFrame[0],this.config.frameHandleThickness),t+=" z",e.attr("d",t)},_renderFrame:function(){var e=this.svg.selectAll("path.frame").data([null]);e.enter().append("path").attr("stroke","white").attr("stroke-width","1px").attr("stroke-linejoin","round").attr("fill",this.config.frameColor).attr("fill-opacity",this.config.frameOpacity).attr("fill-rule","evenodd").classed("frame",!0);var t="";t+=" M "+this.currentFrame[0]+" 0",t+=" H "+(this.currentFrame[1]+this.config.frameHandleThickness*2),t+=" V "+this.config.height,t+=" H "+this.currentFrame[0],t+=" z",t+=" M "+(this.currentFrame[0]+this.config.frameHandleThickness)+" "+this.config.frameTopThickness,t+=" H "+(this.currentFrame[1]+this.config.frameHandleThickness),t+=" v "+this.previewHeight,t+=" H "+(this.currentFrame[0]+this.config.frameHandleThickness),t+=" z",e.attr("d",t)},_renderGrippers:function(){var e=this.svg.selectAll("path.gripper").data([null]);e.enter().append("path").attr("stroke",this.config.gripperColor).classed("gripper",!0);var t="";[.4,.6].forEach(function(e){t+=" M "+Math.round(this.currentFrame[0]+this.config.frameHandleThickness*e)+" "+Math.round(this.config.height*.3),t+=" V "+Math.round(this.config.height*.7),t+=" M "+Math.round(this.currentFrame[1]+this.config.frameHandleThickness*(1+e))+" "+Math.round(this.config.height*.3),t+=" V "+Math.round(this.config.height*.7)}.bind(this)),e.attr("d",t)},_renderHandles:function(){var e=this.svg.selectAll("rect.left_handle").data([null]);e.enter().append("rect").attr("width",this.config.frameHandleThickness).style("cursor","ew-resize").style("fill-opacity","0").classed("left_handle",!0),e.attr("x",this.currentFrame[0]).attr("height",this.config.height);var t=this.svg.selectAll("rect.right_handle").data([null]);t.enter().append("rect").attr("width",this.config.frameHandleThickness).style("cursor","ew-resize").style("fill-opacity","0").classed("right_handle",!0),t.attr("x",this.currentFrame[1]+this.config.frameHandleThickness).attr("height",this.config.height)},_renderMiddle:function(){var e=this.svg.selectAll("rect.middle_handle").data([null]);e.enter().append("rect").style("cursor","move").style("fill-opacity","0").classed("middle_handle",!0),e.attr("width",Math.max(0,this.currentFrame[1]-this.currentFrame[0])).attr("x",this.currentFrame[0]+this.config.frameHandleThickness).attr("height",this.config.height)},_registerMouseEvents:function(){function i(t,i){n.stop=r._getClientXFromEvent(e.event,n);var s=n.stop-n.start,o=r.frameBeforeDrag.slice(0),u=r.config.minimumFrameWidth;n.rigid&&(u=r.frameBeforeDrag[1]-r.frameBeforeDrag[0]),n.left&&(o[0]=Math.max(o[0]+s,0)),n.right&&(o[1]=Math.min(o[1]+s,r.previewWidth));var a=o[1]-o[0];a<=u&&(n.left&&(o[0]=o[1]-u),n.right&&(o[1]=o[0]+u),o[0]<=0&&(o[1]-=o[0],o[0]=0),o[1]>=r.previewWidth&&(o[0]-=o[1]-r.previewWidth,o[1]=r.previewWidth)),r.graphs.forEach(function(t){var n=e.scale.linear().interpolate(e.interpolateNumber).domain([0,r.previewWidth]).range(t.dataDomain()),i=[n(o[0]),n(o[1])];r.slideCallbacks.forEach(function(e){e(t,i[0],i[1])}),o[0]===0&&(i[0]=undefined),o[1]===r.previewWidth&&(i[1]=undefined),t.window.xMin=i[0],t.window.xMax=i[1],t.update()})}function s(){n.target=e.event.target,n.start=r._getClientXFromEvent(e.event,n),r.frameBeforeDrag=r.currentFrame.slice(),e.event.preventDefault?e.event.preventDefault():e.event.returnValue=!1,e.select(document).on("mousemove.rickshaw_range_slider_preview",i),e.select(document).on("mouseup.rickshaw_range_slider_preview",f),e.select(document).on("touchmove.rickshaw_range_slider_preview",i),e.select(document).on("touchend.rickshaw_range_slider_preview",f),e.select(document).on("touchcancel.rickshaw_range_slider_preview",f)}function o(e,t){n.left=!0,s()}function u(e,t){n.right=!0,s()}function a(e,t){n.left=!0,n.right=!0,n.rigid=!0,s()}function f(t,i){e.select(document).on("mousemove.rickshaw_range_slider_preview",null),e.select(document).on("mouseup.rickshaw_range_slider_preview",null),e.select(document).on("touchmove.rickshaw_range_slider_preview",null),e.select(document).on("touchend.rickshaw_range_slider_preview",null),e.select(document).on("touchcancel.rickshaw_range_slider_preview",null),delete r.frameBeforeDrag,n.left=!1,n.right=!1,n.rigid=!1}var t=e.select(this.element),n={target:null,start:null,stop:null,left:!1,right:!1,rigid:!1},r=this;t.select("rect.left_handle").on("mousedown",o),t.select("rect.right_handle").on("mousedown",u),t.select("rect.middle_handle").on("mousedown",a),t.select("rect.left_handle").on("touchstart",o),t.select("rect.right_handle").on("touchstart",u),t.select("rect.middle_handle").on("touchstart",a)},_getClientXFromEvent:function(e,t){switch(e.type){case"touchstart":case"touchmove":var n=e.changedTouches,r=null;for(var i=0;i<n.length;i++)if(n[i].target===t.target){r=n[i];break}return r!==null?r.clientX:undefined;default:return e.clientX}}}),t.namespace("Rickshaw.Graph.Renderer"),t.Graph.Renderer=t.Class.create({initialize:function(e){this.graph=e.graph,this.tension=e.tension||this.tension,this.configure(e)},seriesPathFactory:function(){},seriesStrokeFactory:function(){},defaults:function(){return{tension:.8,strokeWidth:2,unstack:!0,padding:{top:.01,right:0,bottom:.01,left:0},stroke:!1,fill:!1}},domain:function(e){var t=e||this.graph.stackedData||this.graph.stackData(),n=+Infinity,r=-Infinity,i=+Infinity,s=-Infinity;t.forEach(function(e){e.forEach(function(e){if(e.y==null)return;var t=e.y+e.y0;t<i&&(i=t),t>s&&(s=t)});if(!e.length)return;e[0].x<n&&(n=e[0].x),e[e.length-1].x>r&&(r=e[e.length-1].x)}),n-=(r-n)*this.padding.left,r+=(r-n)*this.padding.right,i=this.graph.min==="auto"?i:this.graph.min||0,s=this.graph.max===undefined?s:this.graph.max;if(this.graph.min==="auto"||i<0)i-=(s-i)*this.padding.bottom;return this.graph.max===undefined&&(s+=(s-i)*this.padding.top),{x:[n,r],y:[i,s]}},render:function(e){e=e||{};var t=this.graph,n=e.series||t.series,r=e.vis||t.vis;r.selectAll("*").remove();var i=n.filter(function(e){return!e.disabled}).map(function(e){return e.stack}),s=r.selectAll("path.path").data(i).enter().append("svg:path").classed("path",!0).attr("d",this.seriesPathFactory());if(this.stroke)var o=r.selectAll("path.stroke").data(i).enter().append("svg:path").classed("stroke",!0).attr("d",this.seriesStrokeFactory());var u=0;n.forEach(function(e){if(e.disabled)return;e.path=s[0][u],this.stroke&&(e.stroke=o[0][u]),this._styleSeries(e),u++},this)},_styleSeries:function(t){var n=this.fill?t.color:"none",r=this.stroke?t.color:"none";t.path.setAttribute("fill",n),t.path.setAttribute("stroke",r),t.path.setAttribute("stroke-width",this.strokeWidth),t.className&&e.select(t.path).classed(t.className,!0),t.className&&this.stroke&&e.select(t.stroke).classed(t.className,!0)},configure:function(e){e=e||{},t.keys(this.defaults()).forEach(function(n){if(!e.hasOwnProperty(n)){this[n]=this[n]||this.graph[n]||this.defaults()[n];return}typeof this.defaults()[n]=="object"?t.keys(this.defaults()[n]).forEach(function(t){this[n][t]=e[n][t]!==undefined?e[n][t]:this[n][t]!==undefined?this[n][t]:this.defaults()[n][t]},this):this[n]=e[n]!==undefined?e[n]:this[n]!==undefined?this[n]:this.graph[n]!==undefined?this.graph[n]:this.defaults()[n]},this)},setStrokeWidth:function(e){e!==undefined&&(this.strokeWidth=e)},setTension:function(e){e!==undefined&&(this.tension=e)}}),t.namespace("Rickshaw.Graph.Renderer.Line"),t.Graph.Renderer.Line=t.Class.create(t.Graph.Renderer,{name:"line",defaults:function($super){return t.extend($super(),{unstack:!0,fill:!1,stroke:!0})},seriesPathFactory:function(){var t=this.graph,n=e.svg.line().x(function(e){return t.x(e.x)}).y(function(e){return t.y(e.y)}).interpolate(this.graph.interpolation).tension(this.tension);return n.defined&&n.defined(function(e){return e.y!==null}),n}}),t.namespace("Rickshaw.Graph.Renderer.Stack"),t.Graph.Renderer.Stack=t.Class.create(t.Graph.Renderer,{name:"stack",defaults:function($super){return t.extend($super(),{fill:!0,stroke:!1,unstack:!1})},seriesPathFactory:function(){var t=this.graph,n=e.svg.area().x(function(e){return t.x(e.x)}).y0(function(e){return t.y(e.y0)}).y1(function(e){return t.y(e.y+e.y0)}).interpolate(this.graph.interpolation).tension(this.tension);return n.defined&&n.defined(function(e){return e.y!==null}),n}}),t.namespace("Rickshaw.Graph.Renderer.Bar"),t.Graph.Renderer.Bar=t.Class.create(t.Graph.Renderer,{name:"bar",defaults:function($super){var e=t.extend($super(),{gapSize:.05,unstack:!1});return delete e.tension,e},initialize:function($super,e){e=e||{},this.gapSize=e.gapSize||this.gapSize,$super(e)},domain:function($super){var e=$super(),t=this._frequentInterval(this.graph.stackedData.slice(-1).shift());return e.x[1]+=Number(t.magnitude),e},barWidth:function(e){var t=this._frequentInterval(e.stack),n=this.graph.x.magnitude(t.magnitude)*(1-this.gapSize);return n},render:function(e){e=e||{};var t=this.graph,n=e.series||t.series,r=e.vis||t.vis;r.selectAll("*").remove();var i=this.barWidth(n.active()[0]),s=0,o=n.filter(function(e){return!e.disabled}).length,u=this.unstack?i/o:i,a=function(e){var n=[1,0,0,e.y<0?-1:1,0,e.y<0?t.y.magnitude(Math.abs(e.y))*2:0];return"matrix("+n.join(",")+")"};n.forEach(function(e){if(e.disabled)return;var n=this.barWidth(e),i=r.selectAll("path").data(e.stack.filter(function(e){return e.y!==null})).enter().append("svg:rect").attr("x",function(e){return t.x(e.x)+s}).attr("y",function(e){return t.y(e.y0+Math.abs(e.y))*(e.y<0?-1:1)}).attr("width",u).attr("height",function(e){return t.y.magnitude(Math.abs(e.y))}).attr("transform",a);Array.prototype.forEach.call(i[0],function(t){t.setAttribute("fill",e.color)}),this.unstack&&(s+=u)},this)},_frequentInterval:function(e){var n={};for(var r=0;r<e.length-1;r++){var i=e[r+1].x-e[r].x;n[i]=n[i]||0,n[i]++}var s={count:0,magnitude:1};return t.keys(n).forEach(function(e){s.count<n[e]&&(s={count:n[e],magnitude:e})}),s}}),t.namespace("Rickshaw.Graph.Renderer.Area"),t.Graph.Renderer.Area=t.Class.create(t.Graph.Renderer,{name:"area",defaults:function($super){return t.extend($super(),{unstack:!1,fill:!1,stroke:!1})},seriesPathFactory:function(){var t=this.graph,n=e.svg.area().x(function(e){return t.x(e.x)}).y0(function(e){return t.y(e.y0)}).y1(function(e){return t.y(e.y+e.y0)}).interpolate(t.interpolation).tension(this.tension);return n.defined&&n.defined(function(e){return e.y!==null}),n},seriesStrokeFactory:function(){var t=this.graph,n=e.svg.line().x(function(e){return t.x(e.x)}).y(function(e){return t.y(e.y+e.y0)}).interpolate(t.interpolation).tension(this.tension);return n.defined&&n.defined(function(e){return e.y!==null}),n},render:function(e){e=e||{};var t=this.graph,n=e.series||t.series,r=e.vis||t.vis;r.selectAll("*").remove();var i=this.unstack?"append":"insert",s=n.filter(function(e){return!e.disabled}).map(function(e){return e.stack}),o=r.selectAll("path").data(s).enter()[i]("svg:g","g");o.append("svg:path").attr("d",this.seriesPathFactory()).attr("class","area"),this.stroke&&o.append("svg:path").attr("d",this.seriesStrokeFactory()).attr("class","line");var u=0;n.forEach(function(e){if(e.disabled)return;e.path=o[0][u++],this._styleSeries(e)},this)},_styleSeries:function(t){if(!t.path)return;e.select(t.path).select(".area").attr("fill",t.color),this.stroke&&e.select(t.path).select(".line").attr("fill","none").attr("stroke",t.stroke||e.interpolateRgb(t.color,"black")(.125)).attr("stroke-width",this.strokeWidth),t.className&&t.path.setAttribute("class",t.className)}}),t.namespace("Rickshaw.Graph.Renderer.ScatterPlot"),t.Graph.Renderer.ScatterPlot=t.Class.create(t.Graph.Renderer,{name:"scatterplot",defaults:function($super){return t.extend($super(),{unstack:!0,fill:!0,stroke:!1,padding:{top:.01,right:.01,bottom:.01,left:.01},dotSize:4})},initialize:function($super,e){$super(e)},render:function(e){e=e||{};var t=this.graph,n=e.series||t.series,r=e.vis||t.vis,i=this.dotSize;r.selectAll("*").remove(),n.forEach(function(e){if(e.disabled)return;var n=r.selectAll("path").data(e.stack.filter(function(e){return e.y!==null})).enter().append("svg:circle").attr("cx",function(e){return t.x(e.x)}).attr("cy",function(e){return t.y(e.y)}).attr("r",function(e){return"r"in e?e.r:i});e.className&&n.classed(e.className,!0),Array.prototype.forEach.call(n[0],function(t){t.setAttribute("fill",e.color)})},this)}}),t.namespace("Rickshaw.Graph.Renderer.Multi"),t.Graph.Renderer.Multi=t.Class.create(t.Graph.Renderer,{name:"multi",initialize:function($super,e){$super(e)},defaults:function($super){return t.extend($super(),{unstack:!0,fill:!1,stroke:!0})},configure:function($super,e){e=e||{},this.config=e,$super(e)},domain:function($super){this.graph.stackData();var t=[],n=this._groups();this._stack(n),n.forEach(function(e){var n=e.series.filter(function(e){return!e.disabled}).map(function(e){return e.stack});if(!n.length)return;var r=null;e.renderer&&e.renderer.domain?r=e.renderer.domain(n):r=$super(n),t.push(r)});var r=e.min(t.map(function(e){return e.x[0]})),i=e.max(t.map(function(e){return e.x[1]})),s=e.min(t.map(function(e){return e.y[0]})),o=e.max(t.map(function(e){return e.y[1]}));return{x:[r,i],y:[s,o]}},_groups:function(){var n=this.graph,r={};n.series.forEach(function(i){if(i.disabled)return;if(!r[i.renderer]){var s="http://www.w3.org/2000/svg",o=document.createElementNS(s,"g");n.vis[0][0].appendChild(o);var u=n._renderers[i.renderer],a={},f=[this.defaults(),u.defaults(),this.config,this.graph];f.forEach(function(e){t.extend(a,e)}),u.configure(a),r[i.renderer]={renderer:u,series:[],vis:e.select(o)}}r[i.renderer].series.push(i)},this);var i=[];return Object.keys(r).forEach(function(e){var t=r[e];i.push(t)}),i},_stack:function(n){return n.forEach(function(n){var r=n.series.filter(function(e){return!e.disabled}),i=r.map(function(e){return e.stack});if(!n.renderer.unstack){var s=e.layout.stack(),o=t.clone(s(i));r.forEach(function(e,n){e._stack=t.clone(o[n])})}},this),n},render:function(){this.graph.series.forEach(function(e){if(!e.renderer)throw new Error("Each series needs a renderer for graph 'multi' renderer")}),this.graph.vis.selectAll("*").remove();var e=this._groups();e=this._stack(e),e.forEach(function(e){var t=e.series.filter(function(e){return!e.disabled});t.active=function(){return t},e.renderer.render({series:t,vis:e.vis}),t.forEach(function(e){e.stack=e._stack||e.stack||e.data})})}}),t.namespace("Rickshaw.Graph.Renderer.LinePlot"),t.Graph.Renderer.LinePlot=t.Class.create(t.Graph.Renderer,{name:"lineplot",defaults:function($super){return t.extend($super(),{unstack:!0,fill:!1,stroke:!0,padding:{top:.01,right:.01,bottom:.01,left:.01},dotSize:3,strokeWidth:2})},seriesPathFactory:function(){var t=this.graph,n=e.svg.line().x(function(e){return t.x(e.x)}).y(function(e){return t.y(e.y)}).interpolate(this.graph.interpolation).tension(this.tension);return n.defined&&n.defined(function(e){return e.y!==null}),n},render:function(e){e=e||{};var t=this.graph,n=e.series||t.series,r=e.vis||t.vis,i=this.dotSize;r.selectAll("*").remove();var s=n.filter(function(e){return!e.disabled}).map(function(e){return e.stack}),o=r.selectAll("path").data(s).enter().append("svg:path").attr("d",this.seriesPathFactory()),u=0;n.forEach(function(e){if(e.disabled)return;e.path=o[0][u++],this._styleSeries(e)},this),n.forEach(function(e){if(e.disabled)return;var n=r.selectAll("x").data(e.stack.filter(function(e){return e.y!==null})).enter().append("svg:circle").attr("cx",function(e){return t.x(e.x)}).attr("cy",function(e){return t.y(e.y)}).attr("r",function(e){return"r"in e?e.r:i});Array.prototype.forEach.call(n[0],function(t){if(!t)return;t.setAttribute("data-color",e.color),t.setAttribute("fill","white"),t.setAttribute("stroke",e.color),t.setAttribute("stroke-width",this.strokeWidth)}.bind(this))},this)}}),t.namespace("Rickshaw.Graph.Smoother"),t.Graph.Smoother=t.Class.create({initialize:function(e){this.graph=e.graph,this.element=e.element,this.aggregationScale=1,this.build(),this.graph.stackData.hooks.data.push({name:"smoother",orderPosition:50,f:this.transformer.bind(this)})},build:function(){var e=this,t=jQuery;this.element&&t(function(){t(e.element).slider({min:1,max:100,slide:function(t,n){e.setScale(n.value),e.graph.update()}})})},setScale:function(e){if(e<1)throw"scale out of range: "+e;this.aggregationScale=e,this.graph.update()},transformer:function(e){if(this.aggregationScale==1)return e;var t=[];return e.forEach(function(e){var n=[];while(e.length){var r=0,i=0,s=e.splice(0,this.aggregationScale);s.forEach(function(e){r+=e.x/s.length,i+=e.y/s.length}),n.push({x:r,y:i})}t.push(n)}.bind(this)),t}}),t.namespace("Rickshaw.Graph.Socketio"),t.Graph.Socketio=t.Class.create(t.Graph.Ajax,{request:function(){var e=io.connect(this.dataURL),t=this;e.on("rickshaw",function(e){t.success(e)})}}),t.namespace("Rickshaw.Series"),t.Series=t.Class.create(Array,{initialize:function(e,n,r){r=r||{},this.palette=new t.Color.Palette(n),this.timeBase=typeof r.timeBase=="undefined"?Math.floor((new Date).getTime()/1e3):r.timeBase;var i=typeof r.timeInterval=="undefined"?1e3:r.timeInterval;this.setTimeInterval(i),e&&typeof e=="object"&&Array.isArray(e)&&e.forEach(function(e){this.addItem(e)},this)},addItem:function(e){if(typeof e.name=="undefined")throw"addItem() needs a name";e.color=e.color||this.palette.color(e.name),e.data=e.data||[],e.data.length===0&&this.length&&this.getIndex()>0?this[0].data.forEach(function(t){e.data.push({x:t.x,y:0})}):e.data.length===0&&e.data.push({x:this.timeBase-(this.timeInterval||0),y:0}),this.push(e),this.legend&&this.legend.addLine(this.itemByName(e.name))},addData:function(e,n){var r=this.getIndex();t.keys(e).forEach(function(e){this.itemByName(e)||this.addItem({name:e})},this),this.forEach(function(t){t.data.push({x:n||(r*this.timeInterval||1)+this.timeBase,y:e[t.name]||0})},this)},getIndex:function(){return this[0]&&this[0].data&&this[0].data.length?this[0].data.length:0},itemByName:function(e){for(var t=0;t<this.length;t++)if(this[t].name==e)return this[t]},setTimeInterval:function(e){this.timeInterval=e/1e3},setTimeBase:function(e){this.timeBase=e},dump:function(){var e={timeBase:this.timeBase,timeInterval:this.timeInterval,items:[]};return this.forEach(function(t){var n={color:t.color,name:t.name,data:[]};t.data.forEach(function(e){n.data.push({x:e.x,y:e.y})}),e.items.push(n)}),e},load:function(e){e.timeInterval&&(this.timeInterval=e.timeInterval),e.timeBase&&(this.timeBase=e.timeBase),e.items&&e.items.forEach(function(e){this.push(e),this.legend&&this.legend.addLine(this.itemByName(e.name))},this)}}),t.Series.zeroFill=function(e){t.Series.fill(e,0)},t.Series.fill=function(e,t){var n,r=0,i=e.map(function(e){return e.data});while(r<Math.max.apply(null,i.map(function(e){return e.length})))n=Math.min.apply(null,i.filter(function(e){return e[r]}).map(function(e){return e[r].x})),i.forEach(function(e){(!e[r]||e[r].x!=n)&&e.splice(r,0,{x:n,y:t})}),r++},t.namespace("Rickshaw.Series.FixedDuration"),t.Series.FixedDuration=t.Class.create(t.Series,{initialize:function(e,n,r){r=r||{};if(typeof r.timeInterval=="undefined")throw new Error("FixedDuration series requires timeInterval");if(typeof r.maxDataPoints=="undefined")throw new Error("FixedDuration series requires maxDataPoints");this.palette=new t.Color.Palette(n),this.timeBase=typeof r.timeBase=="undefined"?Math.floor((new Date).getTime()/1e3):r.timeBase,this.setTimeInterval(r.timeInterval),this[0]&&this[0].data&&this[0].data.length?(this.currentSize=this[0].data.length,this.currentIndex=this[0].data.length):(this.currentSize=0,this.currentIndex=0),this.maxDataPoints=r.maxDataPoints,e&&typeof e=="object"&&Array.isArray(e)&&(e.forEach(function(e){this.addItem(e)},this),this.currentSize+=1,this.currentIndex+=1),this.timeBase-=(this.maxDataPoints-this.currentSize)*this.timeInterval;if(typeof this.maxDataPoints!="undefined"&&this.currentSize<this.maxDataPoints)for(var i=this.maxDataPoints-this.currentSize-1;i>1;i--)this.currentSize+=1,this.currentIndex+=1,this.forEach(function(e){e.data.unshift({x:((i-1)*this.timeInterval||1)+this.timeBase,y:0,i:i})},this)},addData:function($super,e,t){$super(e,t),this.currentSize+=1,this.currentIndex+=1;if(this.maxDataPoints!==undefined)while(this.currentSize>this.maxDataPoints)this.dropData()},dropData:function(){this.forEach(function(e){e.data.splice(0,1)}),this.currentSize-=1},getIndex:function(){return this.currentIndex}}),t});