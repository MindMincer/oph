(function(c){function a(){return window.jQuery&&(-1==window.jQuery.event.props.indexOf("dataTransfer"))}if(a()){window.jQuery.event.props.push("dataTransfer")}var b=c.module("lrDragNDrop",[]);b.service("lrDragStore",["$document",function(d){var e={};this.hold=function g(h,i,k,j){e[h]={item:i,collection:k,safe:j===true}};this.get=function(j){var h=e[j],i;if(h){i=h.collection.indexOf(h.item);return h.safe===true?h.item:h.collection.splice(i,1)[0]}else{return null}};this.clean=function f(){e={}};this.isHolding=function(h){return e[h]!==undefined};d.bind("dragend",this.clean)}]);b.service("lrDragHelper",function(){var d=this;d.parseRepeater=function(h,e){var g=e.ngRepeat,f;if(!g){throw Error("this directive must be used with ngRepeat directive")}f=g.match(/^(.*\sin).(\S*)/);if(!f){throw Error("Expected ngRepeat in form of '_item_ in _collection_' but got '"+g+"'.")}return h.$eval(f[2])};d.lrDragSrcDirective=function(e,g){return function f(j,i){i.$set("draggable",true);return function h(n,m,k){var o,l=(g===true?k.lrDragSrcSafe:k.lrDragSrc)||"temp";if(k.lrDragData){n.$watch(k.lrDragData,function(p){o=p})}else{o=d.parseRepeater(n,k)}m.bind("dragstart",function(p){e.hold(l,o[n.$index],o,g);if(angular.isDefined(p.dataTransfer)){p.dataTransfer.setData("text/html",null)}})}}}});b.directive("lrDragSrc",["lrDragStore","lrDragHelper",function(d,e){return{compile:e.lrDragSrcDirective(d)}}]);b.directive("lrDragSrcSafe",["lrDragStore","lrDragHelper",function(d,e){return{compile:e.lrDragSrcDirective(d,true)}}]);b.directive("lrDropTarget",["lrDragStore","lrDragHelper","$parse",function(d,f,e){return{link:function(l,k,h){var m,j=h.lrDropTarget||"temp",i=null;function g(o,p){return(k[0].offsetHeight-o*k[0].offsetHeight/k[0].offsetWidth)<p}function n(){if(i!==null){k.removeClass(i);i=null}}if(h.lrDragData){l.$watch(h.lrDragData,function(o){m=o})}else{m=f.parseRepeater(l,h)}k.bind("drop",function(p){var t=c.copy(m),s=d.get(j),q,r,o;if(s!==null){q=l.$index;q=g(p.offsetX,p.offsetY)?q+1:q;if(t.length>m.length){for(r=0,o=Math.min(q,m.length-1);r<=o;r++){if(!c.equals(t[r],m[r])){q=q-1;break}}}l.$apply(function(){m.splice(q,0,s);var u=e(h.lrDropSuccess)||c.noop;u(l,{e:p,item:s,collection:m})});p.preventDefault();n();d.clean()}});k.bind("dragleave",n);k.bind("dragover",function(o){var p;if(d.isHolding(j)){p=g(o.offsetX,o.offsetY)?"lr-drop-target-after":"lr-drop-target-before";if(i!==p&&i!==null){k.removeClass(i)}if(i!==p){k.addClass(p)}i=p}o.preventDefault()})}}}])})(angular);